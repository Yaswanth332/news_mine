{% extends 'recommendation/auth_layout.html' %}
{% load static %}

{% block title %}Register - Crop Selector{% endblock %}

{% block auth_form %}
<h2 class="text-white mb-4">Join Our Farming Community!</h2>
<p class="text-white-75 mb-4">
    Create your account to get personalized crop recommendations and insights.
</p>

<form method="post" class="needs-validation" novalidate>
    {% csrf_token %}

    {% if form.non_field_errors %}
        <div class="alert alert-danger mb-3" role="alert">
            {% for error in form.non_field_errors %}
                <p class="mb-0">{{ error }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <div class="form-group mb-3">
        <label for="id_username" class="form-label">Username</label>
        <div class="input-group">
            <span class="input-group-text"><i class="fas fa-user"></i></span>
            <input type="text" name="username" id="id_username" class="form-control" placeholder="Choose a username" required>
        </div>
        {% if form.username.errors %}
            <div class="error-message mt-1">
                {% for error in form.username.errors %}{{ error }}{% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="form-group mb-3">
        <label for="id_email" class="form-label">Email</label>
        <div class="input-group">
            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
            <input type="email" name="email" id="id_email" class="form-control" placeholder="Enter your email" required>
        </div>
        {% if form.email.errors %}
            <div class="error-message mt-1">
                {% for error in form.email.errors %}{{ error }}{% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="form-group mb-3">
        <label for="id_password1" class="form-label">Password</label>
        <div class="input-group">
            <span class="input-group-text"><i class="fas fa-lock"></i></span>
            <input type="password" name="password" id="id_password1" class="form-control" placeholder="Create a password" required>
        </div>
        {% if form.password.errors %}
            <div class="error-message mt-1">
                {% for error in form.password.errors %}{{ error }}{% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="form-group mb-4">
        <label for="id_password2" class="form-label">Confirm Password</label>
        <div class="input-group">
            <span class="input-group-text"><i class="fas fa-lock"></i></span>
            <input type="password" name="password2" id="id_password2" class="form-control" placeholder="Confirm your password" required>
        </div>
        {% if form.password2.errors %}
            <div class="error-message mt-1">
                {% for error in form.password2.errors %}{{ error }}{% endfor %}
            </div>
        {% endif %}
    </div>

    <button type="submit" class="auth-btn mb-3">Register</button>

    <p class="text-center text-white-75 small">
        Already have an account? <a href="{% url 'login' %}" class="auth-link" id="toLogin">Login here</a>
    </p>

    <div class="d-flex justify-content-center align-items-center my-3">
        <hr class="flex-grow-1" style="border-color: rgba(255,255,255,0.2);"> 
        <span class="mx-3 text-white-75">OR</span>
        <hr class="flex-grow-1" style="border-color: rgba(255,255,255,0.2);">
    </div>

    <a href="{% url 'social:begin' 'google-oauth2' %}" class="btn btn-outline-secondary d-flex align-items-center justify-content-center mb-3 py-2" style="font-size: 0.95rem; font-weight: 500;">
        <i class="fab fa-google me-2"></i> Sign up with Google
    </a>

    <p class="text-center text-white-50 small mt-4">
        By registering, you agree to our <a href="#" class="auth-link">Terms of Service</a> and <a href="#" class="auth-link">Privacy Policy</a>.
    </p>
</form>

<script>
    // Client-side validation for demonstration (Django handles server-side)
    (function () {
        'use strict'
        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
    })()
</script>
{% endblock %}